<!DOCTYPE html>
<html>
<head>
    <title>課程連結修復最終測試</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .summary { 
            background: #e3f2fd; 
            border: 2px solid #2196f3; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px; 
        }
        .test-case { 
            border: 1px solid #ddd; 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 5px;
            background: #f9f9f9;
        }
        .success { background-color: #e8f5e8; border-color: #4caf50; }
        .error { background-color: #ffe8e8; border-color: #f44336; }
        .code { background: #f5f5f5; padding: 10px; border-radius: 3px; font-family: monospace; }
        h1, h2 { color: #333; }
        h3 { color: #555; margin-top: 0; }
    </style>
</head>
<body>
    <h1>🔗 課程連結修復最終測試</h1>
    
    <div class="summary">
        <h2>📋 修復說明</h2>
        <p><strong>問題：</strong> 當個別 Session 的連結為佔位符（如 <code>https://meet.google.com/course-session</code>）時，沒有正確回退到統一設定中的連結。</p>
        
        <p><strong>解決方案：</strong> 修改 <code>getCourseLinksFromTemplate</code> 函數，讓它不僅檢查空值，也檢查佔位符連結，並在發現佔位符時回退到統一設定。</p>
        
        <p><strong>修復要點：</strong></p>
        <ul>
            <li>空值或佔位符連結 → 使用統一設定</li>
            <li>有效的個別連結 → 直接使用個別連結</li>
            <li>統一設定也是佔位符 → 返回 null（顯示未設置）</li>
        </ul>
    </div>
    
    <h2>🧪 測試案例</h2>
    
    <div class="test-case success">
        <h3>✅ 案例 1: 個別連結有效</h3>
        <div class="code">
Session: "Lesson 1"
個別教室連結: "https://meet.google.com/lesson-1-room" ✓
個別教材連結: "https://drive.google.com/lesson-1-materials" ✓
統一教室連結: "https://meet.google.com/global-classroom"
統一教材連結: "https://drive.google.com/global-materials"

結果: 使用個別連結（因為個別連結有效）
</div>
    </div>
    
    <div class="test-case success">
        <h3>✅ 案例 2: 個別連結為空</h3>
        <div class="code">
Session: "Lesson 2"
個別教室連結: "" (空)
個別教材連結: "" (空)
統一教室連結: "https://meet.google.com/global-classroom"
統一教材連結: "https://drive.google.com/global-materials"

結果: 使用統一設定（因為個別連結為空）
</div>
    </div>
    
    <div class="test-case success">
        <h3>✅ 案例 3: 個別連結為佔位符 (修復重點)</h3>
        <div class="code">
Session: "Lesson 3"
個別教室連結: "https://meet.google.com/course-session" (佔位符)
個別教材連結: "" (空)
統一教室連結: "https://meet.google.com/global-classroom"
統一教材連結: "https://drive.google.com/global-materials"

結果: 使用統一設定（因為個別連結是佔位符，被視為無效）
</div>
    </div>
    
    <div class="test-case">
        <h3>📝 修復前 vs 修復後</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #f0f0f0;">
                <th style="border: 1px solid #ddd; padding: 8px;">情況</th>
                <th style="border: 1px solid #ddd; padding: 8px;">修復前</th>
                <th style="border: 1px solid #ddd; padding: 8px;">修復後</th>
            </tr>
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">個別連結有效</td>
                <td style="border: 1px solid #ddd; padding: 8px;">✅ 使用個別連結</td>
                <td style="border: 1px solid #ddd; padding: 8px;">✅ 使用個別連結</td>
            </tr>
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">個別連結為空</td>
                <td style="border: 1px solid #ddd; padding: 8px;">✅ 使用統一設定</td>
                <td style="border: 1px solid #ddd; padding: 8px;">✅ 使用統一設定</td>
            </tr>
            <tr style="background: #fff3cd;">
                <td style="border: 1px solid #ddd; padding: 8px;">個別連結為佔位符</td>
                <td style="border: 1px solid #ddd; padding: 8px;">❌ 顯示佔位符按鈕</td>
                <td style="border: 1px solid #ddd; padding: 8px;">✅ 使用統一設定</td>
            </tr>
        </table>
    </div>
    
    <div class="summary">
        <h2>🎯 修復結果</h2>
        <p>現在教師在儀表板和我的預約頁面中：</p>
        <ul>
            <li><strong>進入教室按鈕</strong>：會正確獲取課程模組中對應 Lesson 的教室連結，如果該連結為空或佔位符，則使用統一設定中的教室連結</li>
            <li><strong>查看教材按鈕</strong>：會正確獲取課程模組中對應 Lesson 的教材連結，如果該連結為空或佔位符，則使用統一設定中的教材連結</li>
            <li><strong>顯示邏輯</strong>：只有在獲得有效連結時才顯示可點擊按鈕，否則顯示灰色的未設置狀態</li>
        </ul>
        
        <p style="color: #2e7d32; font-weight: bold;">✅ 修復完成！課程連結邏輯現在能正確處理佔位符並回退到統一設定。</p>
    </div>
</body>
</html>