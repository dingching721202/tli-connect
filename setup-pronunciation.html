<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­ç½® Pronunciation æ¸¬è©¦è³‡æ–™</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .success {
            background: #28a745;
        }
        .success:hover {
            background: #1e7e34;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ è¨­ç½® Pronunciation èª²ç¨‹æ¸¬è©¦è³‡æ–™</h1>
        
        <div class="warning">
            <strong>âš ï¸ é‡è¦æç¤ºï¼š</strong>
            <ul>
                <li>æ­¤å·¥å…·å°‡å‰µå»º Pronunciation èª²ç¨‹æ¨¡æ¿å’Œæ’ç¨‹</li>
                <li>æ¯å€‹ Lesson éƒ½æœƒæœ‰ç¨ç‰¹çš„ Zoom é€£çµ</li>
                <li>è¨­ç½®å®Œæˆå¾Œè«‹é‡æ–°æ•´ç†ç›¸é—œé é¢</li>
                <li>é€™æ˜¯æ¸¬è©¦è³‡æ–™ï¼Œå¯ä»¥å®‰å…¨åœ°é‡è¤‡åŸ·è¡Œ</li>
            </ul>
        </div>
        
        <div>
            <button class="button" onclick="setupPronunciation()">ğŸš€ è¨­ç½® Pronunciation èª²ç¨‹</button>
            <button class="button" onclick="validateSetup()">âœ… é©—è­‰è¨­ç½®</button>
            <button class="button" onclick="clearLogs()">ğŸ§¹ æ¸…é™¤æ—¥èªŒ</button>
            <button class="button success" onclick="goToApp()">ğŸ“± å‰å¾€æ‡‰ç”¨</button>
        </div>
        
        <div id="logs" class="log">ç­‰å¾…åŸ·è¡Œ...</div>
        
        <h2>ğŸ“‹ èª²ç¨‹é…ç½®è©³æƒ…</h2>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 4px;">
            <h3>Pronunciation èª²ç¨‹åŒ…å«ä»¥ä¸‹ Lessonï¼š</h3>
            <ul>
                <li><strong>Lesson 1</strong> - Pronunciation of Consonant & Vowel
                    <br>ğŸ”— <code>https://us06web.zoom.us/j/7212021983?pwd=Jhb69e1fj4rk6ShfjL9gBCmdFmFO7t.1</code></li>
                <li><strong>Lesson 2</strong> - Stress and Rhythm
                    <br>ğŸ”— <code>https://us06web.zoom.us/j/7212021984?pwd=Jhb69e1fj4rk6ShfjL9gBCmdFmFO7t.2</code></li>
                <li><strong>Lesson 3</strong> - Intonation Patterns
                    <br>ğŸ”— <code>https://us06web.zoom.us/j/7212021985?pwd=Jhb69e1fj4rk6ShfjL9gBCmdFmFO7t.3</code></li>
                <li><strong>Lesson 4</strong> - Connected Speech
                    <br>ğŸ”— <code>https://us06web.zoom.us/j/7212021986?pwd=Jhb69e1fj4rk6ShfjL9gBCmdFmFO7t.4</code></li>
            </ul>
            <p><strong>æ•™å¸«ï¼š</strong>ç‹è€å¸«</p>
            <p><strong>æ™‚é–“ï¼š</strong>é€±äºŒã€é€±å›› 19:00-20:30</p>
        </div>
    </div>

    <script>
        const logElement = document.getElementById('logs');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function clearLogs() {
            logElement.textContent = '';
        }
        
        // è¨­ç½® Pronunciation èª²ç¨‹æ¨¡æ¿
        function setupPronunciationTemplate() {
            log('ğŸ“ è¨­ç½®èª²ç¨‹æ¨¡æ¿...');
            
            const templates = JSON.parse(localStorage.getItem('courseTemplates') || '[]');
            
            // ç§»é™¤ç¾æœ‰çš„ Pronunciation æ¨¡æ¿
            const filteredTemplates = templates.filter(t => !t.title.toLowerCase().includes('pronunciation'));
            
            // å‰µå»ºæ–°çš„ Pronunciation æ¨¡æ¿
            const pronunciationTemplate = {
                id: 'template_pronunciation_' + Date.now(),
                title: 'Pronunciation',
                description: 'è‹±èªç™¼éŸ³è¨“ç·´èª²ç¨‹ï¼Œå°ˆæ³¨æ–¼å­éŸ³æ¯éŸ³ç™¼éŸ³ã€é‡éŸ³ç¯€å¥ã€èªèª¿ç­‰æŠ€å·§',
                category: 'è‹±æ–‡',
                level: 'åˆç´š',
                totalSessions: 4,
                capacity: 15,
                // çµ±ä¸€è¨­å®š - ç•¶å€‹åˆ¥Sessioné€£çµç‚ºç©ºæ™‚ä½¿ç”¨
                globalSettings: {
                    defaultTitle: 'Lesson {n}',
                    defaultVirtualClassroomLink: 'https://us06web.zoom.us/j/7212021900?pwd=DefaultPronunciationRoom',
                    defaultMaterialLink: '/materials/pronunciation/default-materials.pdf'
                },
                sessions: [
                    {
                        sessionNumber: 1,
                        title: 'Lesson 1 - Pronunciation of Consonant & Vowel',
                        virtualClassroomLink: 'https://us06web.zoom.us/j/7212021983?pwd=Jhb69e1fj4rk6ShfjL9gBCmdFmFO7t.1',
                        materialLink: '/materials/pronunciation/lesson1-consonant-vowel.pdf',
                        useGlobalTitle: false,
                        useGlobalClassroom: false,
                        useGlobalMaterial: false
                    },
                    {
                        sessionNumber: 2,
                        title: 'Lesson 2 - Stress and Rhythm',
                        virtualClassroomLink: 'https://us06web.zoom.us/j/7212021984?pwd=Jhb69e1fj4rk6ShfjL9gBCmdFmFO7t.2',
                        materialLink: '/materials/pronunciation/lesson2-stress-rhythm.pdf',
                        useGlobalTitle: false,
                        useGlobalClassroom: false,
                        useGlobalMaterial: false
                    },
                    {
                        sessionNumber: 3,
                        title: 'Lesson 3 - Intonation Patterns',
                        virtualClassroomLink: '', // ğŸ”§ ç•™ç©ºä»¥æ¸¬è©¦çµ±ä¸€è¨­å®š
                        materialLink: '', // ğŸ”§ ç•™ç©ºä»¥æ¸¬è©¦çµ±ä¸€è¨­å®š
                        useGlobalTitle: false,
                        useGlobalClassroom: true, // ä½¿ç”¨çµ±ä¸€æ•™å®¤è¨­å®š
                        useGlobalMaterial: true // ä½¿ç”¨çµ±ä¸€æ•™æè¨­å®š
                    },
                    {
                        sessionNumber: 4,
                        title: 'Lesson 4 - Connected Speech',
                        virtualClassroomLink: 'https://us06web.zoom.us/j/7212021986?pwd=Jhb69e1fj4rk6ShfjL9gBCmdFmFO7t.4',
                        materialLink: '/materials/pronunciation/lesson4-connected-speech.pdf',
                        useGlobalTitle: false,
                        useGlobalClassroom: false,
                        useGlobalMaterial: false
                    }
                ],
                status: 'published',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            filteredTemplates.push(pronunciationTemplate);
            localStorage.setItem('courseTemplates', JSON.stringify(filteredTemplates));
            
            log('âœ… Pronunciation èª²ç¨‹æ¨¡æ¿å·²è¨­ç½®');
            return pronunciationTemplate;
        }

        // è¨­ç½®èª²ç¨‹æ’ç¨‹
        function setupPronunciationSchedule(templateId) {
            log('ğŸ“… è¨­ç½®èª²ç¨‹æ’ç¨‹...');
            
            const schedules = JSON.parse(localStorage.getItem('courseSchedules') || '[]');
            
            // ç§»é™¤ç¾æœ‰çš„ Pronunciation æ’ç¨‹
            const filteredSchedules = schedules.filter(s => s.templateId !== templateId);
            
            // å‰µå»ºæ–°çš„æ’ç¨‹
            const pronunciationSchedule = {
                id: 'schedule_pronunciation_' + Date.now(),
                templateId: templateId,
                templateTitle: 'Pronunciation',
                seriesName: '',
                teacherId: '1',
                teacherName: 'ç‹è€å¸«',
                timeSlots: [
                    {
                        id: 'slot_1',
                        weekdays: [2, 4], // é€±äºŒã€é€±å››
                        startTime: '19:00',
                        endTime: '20:30',
                        teacherId: '1'
                    }
                ],
                startDate: '2025-08-01',
                endDate: '2025-09-30',
                excludeDates: [],
                generatedSessions: [],
                status: 'published',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            filteredSchedules.push(pronunciationSchedule);
            localStorage.setItem('courseSchedules', JSON.stringify(filteredSchedules));
            
            log('âœ… Pronunciation èª²ç¨‹æ’ç¨‹å·²è¨­ç½®');
            return pronunciationSchedule;
        }

        // è¨­ç½®æ¸¬è©¦é ç´„
        function setupTestBooking(templateId) {
            log('ğŸ“‹ è¨­ç½®æ¸¬è©¦é ç´„...');
            
            const appointments = JSON.parse(localStorage.getItem('classAppointments') || '[]');
            
            // æª¢æŸ¥æ˜¯å¦å·²æœ‰æ¸¬è©¦é ç´„
            const hasTestBooking = appointments.some(apt => 
                apt.course_name && apt.course_name.includes('Pronunciation')
            );
            
            if (!hasTestBooking) {
                // å‰µå»ºæ¸¬è©¦é ç´„ - Alice Wang é ç´„ Pronunciation Lesson 1
                const testAppointment = {
                    id: Date.now(),
                    user_id: 2, // Alice Wang
                    class_timeslot_id: Math.abs((templateId + '_session_1').split('').reduce((a, b) => (a << 5) - a + b.charCodeAt(0), 0)),
                    course_name: 'Pronunciation - Lesson 1 - Pronunciation of Consonant & Vowel',
                    status: 'CONFIRMED',
                    created_at: new Date().toISOString(),
                    booking_date: '2025-08-05',
                    booking_time: '19:00-20:30'
                };
                
                appointments.push(testAppointment);
                localStorage.setItem('classAppointments', JSON.stringify(appointments));
                
                log('âœ… æ¸¬è©¦é ç´„å·²å‰µå»º - Alice Wang é ç´„ Pronunciation Lesson 1');
            } else {
                log('âœ… æ¸¬è©¦é ç´„å·²å­˜åœ¨');
            }
        }

        // ä¸»è¦è¨­ç½®å‡½æ•¸
        function setupPronunciation() {
            try {
                log('ğŸš€ é–‹å§‹è¨­ç½® Pronunciation èª²ç¨‹...');
                clearLogs();
                log('ğŸš€ é–‹å§‹è¨­ç½® Pronunciation èª²ç¨‹...');
                
                const template = setupPronunciationTemplate();
                const schedule = setupPronunciationSchedule(template.id);
                setupTestBooking(template.id);
                
                // è§¸ç™¼æ›´æ–°äº‹ä»¶
                window.dispatchEvent(new CustomEvent('courseTemplatesUpdated'));
                window.dispatchEvent(new CustomEvent('courseSchedulesUpdated'));
                
                log('ğŸ‰ Pronunciation èª²ç¨‹è¨­ç½®å®Œæˆï¼');
                log('ğŸ“± è«‹é‡æ–°æ•´ç†æ‡‰ç”¨é é¢ä»¥æŸ¥çœ‹æ›´æ–°');
                
            } catch (error) {
                log('âŒ è¨­ç½®å¤±æ•—: ' + error.message);
                console.error(error);
            }
        }

        // é©—è­‰è¨­ç½®
        function validateSetup() {
            try {
                log('ğŸ” é–‹å§‹é©—è­‰è¨­ç½®...');
                
                // é©—è­‰èª²ç¨‹æ¨¡æ¿
                const templates = JSON.parse(localStorage.getItem('courseTemplates') || '[]');
                const pronunciationTemplate = templates.find(t => t.title === 'Pronunciation');
                
                if (!pronunciationTemplate) {
                    log('âŒ æœªæ‰¾åˆ° Pronunciation èª²ç¨‹æ¨¡æ¿');
                    return false;
                }
                
                log('âœ… èª²ç¨‹æ¨¡æ¿å­˜åœ¨: ' + pronunciationTemplate.title);
                log('ğŸ“š ç¸½èª²ç¨‹æ•¸: ' + pronunciationTemplate.totalSessions);
                
                pronunciationTemplate.sessions.forEach(session => {
                    log(`  - Lesson ${session.sessionNumber}: ${session.title}`);
                    log(`    ğŸ”— è™›æ“¬æ•™å®¤: ${session.virtualClassroomLink}`);
                    log(`    ğŸ“„ æ•™æ: ${session.materialLink}`);
                });
                
                // é©—è­‰èª²ç¨‹æ’ç¨‹
                const schedules = JSON.parse(localStorage.getItem('courseSchedules') || '[]');
                const pronunciationSchedule = schedules.find(s => s.templateId === pronunciationTemplate.id);
                
                if (!pronunciationSchedule) {
                    log('âŒ æœªæ‰¾åˆ° Pronunciation èª²ç¨‹æ’ç¨‹');
                    return false;
                }
                
                log('âœ… èª²ç¨‹æ’ç¨‹å­˜åœ¨: ' + pronunciationSchedule.id);
                log('ğŸ‘¨â€ğŸ« æ•™å¸«: ' + pronunciationSchedule.teacherName);
                
                // é©—è­‰é ç´„è³‡æ–™
                const appointments = JSON.parse(localStorage.getItem('classAppointments') || '[]');
                const pronunciationBookings = appointments.filter(apt => 
                    apt.course_name && apt.course_name.includes('Pronunciation')
                );
                
                log('âœ… æ¸¬è©¦é ç´„æ•¸é‡: ' + pronunciationBookings.length);
                pronunciationBookings.forEach(booking => {
                    log(`  - ç”¨æˆ¶${booking.user_id}: ${booking.course_name}`);
                });
                
                log('ğŸ‰ é©—è­‰å®Œæˆï¼è¨­ç½®æ­£ç¢º');
                return true;
                
            } catch (error) {
                log('âŒ é©—è­‰å¤±æ•—: ' + error.message);
                console.error(error);
                return false;
            }
        }

        function goToApp() {
            window.open('http://localhost:3000', '_blank');
        }
    </script>
</body>
</html>