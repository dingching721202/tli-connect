<!DOCTYPE html>
<html>
<head>
    <title>基於Lesson編號的課程連結測試</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .summary { 
            background: #e8f5e8; 
            border: 2px solid #4caf50; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px; 
        }
        .before-after { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin: 20px 0; 
        }
        .before, .after { 
            padding: 15px; 
            border-radius: 5px; 
        }
        .before { 
            background: #ffe8e8; 
            border: 1px solid #f44336; 
        }
        .after { 
            background: #e8f5e8; 
            border: 1px solid #4caf50; 
        }
        .code { 
            background: #f5f5f5; 
            padding: 10px; 
            border-radius: 3px; 
            font-family: monospace; 
            margin: 10px 0;
            overflow-x: auto;
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 15px 0; 
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 12px; 
            text-align: left; 
        }
        th { 
            background-color: #f2f2f2; 
            font-weight: bold; 
        }
        .highlight { background-color: #ffffcc; }
        .scenario { 
            background: #f0f8ff; 
            border: 1px solid #4682b4; 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>🎯 基於Lesson編號的課程連結修復</h1>
    
    <div class="summary">
        <h2>✅ 修復完成</h2>
        <p><strong>現在教師在儀表板和我的預約頁面中的課程連結完全按照以下規則運作：</strong></p>
        <ol>
            <li><strong>根據課程名稱找到對應的課程模組</strong></li>
            <li><strong>依據 Lesson 編號獲取對應的教室連結和教材連結</strong></li>
            <li><strong>如果該 Lesson 有連結就用該連結，沒有就用統一設定的連結</strong></li>
        </ol>
    </div>
    
    <div class="before-after">
        <div class="before">
            <h3>❌ 修復前</h3>
            <div class="code">
// 只使用完整課程名稱
const courseLinks = getValidCourseLinks(
  selectedBooking.courseName
);

// 問題：沒有明確指定Lesson編號
// 依賴從課程名稱中解析編號
            </div>
        </div>
        
        <div class="after">
            <h3>✅ 修復後</h3>
            <div class="code">
// 優先使用sessionNumber
if (selectedBooking.sessionNumber) {
  const baseName = selectedBooking.courseName.split(' - ')[0];
  courseLinks = getCourseLinksForLesson(baseName, selectedBooking.sessionNumber);
} else {
  // 回退到從課程名稱解析
  const parsed = parseCourseNameAndLesson(selectedBooking.courseName);
  if (parsed) {
    courseLinks = getCourseLinksForLesson(parsed.courseName, parsed.lessonNumber);
  }
}
            </div>
        </div>
    </div>
    
    <h2>🔧 新增的函數</h2>
    
    <div class="scenario">
        <h3>getCourseLinksForLesson(courseName, lessonNumber)</h3>
        <p><strong>用途：</strong>直接根據課程名稱和Lesson編號獲取連結</p>
        <div class="code">
// 範例
const links = getCourseLinksForLesson('Pronunciation', 3);
// 會查找 Pronunciation 課程的 Lesson 3
// 如果 Lesson 3 有個別連結 → 使用個別連結
// 如果 Lesson 3 沒有連結 → 使用統一設定連結
        </div>
    </div>
    
    <h2>📊 測試案例</h2>
    
    <table>
        <tr>
            <th>頁面</th>
            <th>課程名稱</th>
            <th>Lesson編號</th>
            <th>個別教室</th>
            <th>個別教材</th>
            <th>統一教室</th>
            <th>統一教材</th>
            <th>最終教室</th>
            <th>最終教材</th>
        </tr>
        <tr>
            <td>我的預約</td>
            <td>Pronunciation - Lesson 1</td>
            <td>1</td>
            <td>meet.google.com/lesson-1</td>
            <td>drive.google.com/lesson-1</td>
            <td>meet.google.com/global</td>
            <td>drive.google.com/global</td>
            <td class="highlight">meet.google.com/lesson-1</td>
            <td class="highlight">drive.google.com/lesson-1</td>
        </tr>
        <tr>
            <td>我的預約</td>
            <td>Pronunciation - Lesson 2</td>
            <td>2</td>
            <td>(空)</td>
            <td>(空)</td>
            <td>meet.google.com/global</td>
            <td>drive.google.com/global</td>
            <td class="highlight">meet.google.com/global</td>
            <td class="highlight">drive.google.com/global</td>
        </tr>
        <tr>
            <td>儀表板</td>
            <td>Basic English - Lesson 3</td>
            <td>3</td>
            <td>zoom.us/lesson-3</td>
            <td>(空)</td>
            <td>meet.google.com/global</td>
            <td>drive.google.com/global</td>
            <td class="highlight">zoom.us/lesson-3</td>
            <td class="highlight">drive.google.com/global</td>
        </tr>
    </table>
    
    <h2>🎯 具體運作流程</h2>
    
    <div class="scenario">
        <h3>1. 我的預約頁面</h3>
        <div class="code">
1. 檢查 selectedBooking.sessionNumber
   ├─ 有 sessionNumber → 使用 getCourseLinksForLesson(baseName, sessionNumber)
   └─ 沒有 sessionNumber → 從課程名稱解析 Lesson 編號

2. 在課程模組中查找對應的 Session
   ├─ 找到 Session → 檢查個別連結
   │   ├─ 有個別連結 → 使用個別連結
   │   └─ 沒有個別連結 → 使用統一設定連結
   └─ 找不到 Session → 返回 null (顯示未設置)
        </div>
    </div>
    
    <div class="scenario">
        <h3>2. 儀表板頁面</h3>
        <div class="code">
1. 從 selectedBooking.title 或 selectedBooking.courseName 獲取課程名稱

2. 使用 parseCourseNameAndLesson() 解析課程名稱和 Lesson 編號
   ├─ 解析成功 → 使用 getCourseLinksForLesson(courseName, lessonNumber)
   └─ 解析失敗 → 顯示警告，無法獲取連結

3. 在課程模組中查找對應的 Session (同上流程)
        </div>
    </div>
    
    <div class="summary">
        <h2>🎉 修復結果</h2>
        <p><strong>現在系統完全按照要求運作：</strong></p>
        <ul>
            <li>✅ <strong>根據課程名稱找到對應的課程模組</strong></li>
            <li>✅ <strong>依據 Lesson 編號獲取對應的連結</strong></li>
            <li>✅ <strong>個別連結優先，沒有則使用統一設定</strong></li>
            <li>✅ <strong>適用於儀表板和我的預約頁面</strong></li>
        </ul>
        
        <p style="color: #2e7d32; font-weight: bold;">
            🚀 教師現在可以正確地從課程模組中獲取每個 Lesson 的專屬連結！
        </p>
    </div>
</body>
</html>