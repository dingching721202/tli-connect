<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœƒå“¡æ–¹æ¡ˆåŒæ­¥æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { border: 1px solid #ddd; padding: 20px; margin: 10px 0; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; white-space: pre-wrap; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
        .plan { border: 1px solid #eee; padding: 10px; margin: 5px 0; border-radius: 4px; }
        .published { background: #d4edda; }
        .draft { background: #f8d7da; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ æœƒå“¡æ–¹æ¡ˆåŒæ­¥æ¸¬è©¦</h1>
        
        <div class="section">
            <h2>localStorage æ“ä½œ</h2>
            <button onclick="clearLocalStorage()">æ¸…ç©º localStorage</button>
            <button onclick="initializeData()">åˆå§‹åŒ–è³‡æ–™</button>
            <button onclick="showLocalStorage()">é¡¯ç¤º localStorage</button>
        </div>

        <div class="section">
            <h2>æ–¹æ¡ˆç‹€æ…‹æ¸¬è©¦</h2>
            <button onclick="togglePlanStatus(1)">åˆ‡æ›æ–¹æ¡ˆ 1 ç‹€æ…‹</button>
            <button onclick="togglePlanStatus(2)">åˆ‡æ›æ–¹æ¡ˆ 2 ç‹€æ…‹</button>
            <button onclick="togglePlanStatus(3)">åˆ‡æ›æ–¹æ¡ˆ 3 ç‹€æ…‹</button>
            <button onclick="refreshPlans()">é‡æ–°è¼‰å…¥æ–¹æ¡ˆ</button>
        </div>

        <div class="section">
            <h2>ç•¶å‰æ–¹æ¡ˆç‹€æ…‹</h2>
            <div id="plans"></div>
        </div>

        <div class="section">
            <h2>åŸ·è¡Œæ—¥èªŒ</h2>
            <button onclick="clearLog()">æ¸…ç©ºæ—¥èªŒ</button>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script>
        // æ””æˆª console.log é¡¯ç¤ºåœ¨é é¢ä¸Š
        const originalLog = console.log;
        const logElement = document.getElementById('log');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            logElement.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
            logElement.scrollTop = logElement.scrollHeight;
        };

        function clearLog() {
            logElement.textContent = '';
        }

        function clearLocalStorage() {
            localStorage.removeItem('memberCardPlans');
            localStorage.removeItem('memberCards');
            console.log('ğŸ—‘ï¸ localStorage å·²æ¸…ç©º');
            refreshPlans();
        }

        function initializeData() {
            const staticData = [
                {
                    "id": 1,
                    "created_at": "2025-07-14T12:00:00+00:00",
                    "member_card_id": 1,
                    "type": "SEASON",
                    "name": "å€‹äººå­£åº¦æ–¹æ¡ˆ",
                    "price": "3000.00",
                    "original_price": "3000.00",
                    "duration": 3,
                    "plan_type": "individual",
                    "features": ["ç„¡é™è§€çœ‹æ‰€æœ‰å­¸ç¿’å½±ç‰‡", "åƒåŠ ç·šä¸Šåœ˜é«”èª²ç¨‹", "å…è²»é ç´„èª²ç¨‹æ´»å‹•", "24å°æ™‚å®¢æœæ”¯æ´", "å­¸ç¿’é€²åº¦è¿½è¹¤"],
                    "status": "PUBLISHED",
                    "category": "season"
                },
                {
                    "id": 2,
                    "created_at": "2025-07-14T12:00:00+00:00",
                    "member_card_id": 2,
                    "type": "YEAR",
                    "name": "å€‹äººå¹´åº¦æ–¹æ¡ˆ",
                    "price": "10000.00",
                    "original_price": "12000.00",
                    "duration": 12,
                    "plan_type": "individual",
                    "features": ["ç„¡é™è§€çœ‹æ‰€æœ‰å­¸ç¿’å½±ç‰‡", "åƒåŠ ç·šä¸Šåœ˜é«”èª²ç¨‹", "å…è²»é ç´„èª²ç¨‹æ´»å‹•", "24å°æ™‚å„ªå…ˆå®¢æœæ”¯æ´", "å­¸ç¿’é€²åº¦è¿½è¹¤", "å°ˆå±¬å­¸ç¿’é¡§å•", "æœƒå“¡å°ˆå±¬æ´»å‹•", "èª²ç¨‹è³‡æ–™ä¸‹è¼‰"],
                    "status": "PUBLISHED",
                    "category": "year"
                },
                {
                    "id": 3,
                    "created_at": "2025-07-14T12:00:00+00:00",
                    "member_card_id": 3,
                    "type": "CORPORATE",
                    "name": "ä¼æ¥­å®¢è£½æ–¹æ¡ˆ",
                    "price": "0.00",
                    "original_price": "0.00",
                    "duration": 12,
                    "plan_type": "corporate",
                    "features": ["å®¢è£½åŒ–åŸ¹è¨“å…§å®¹", "å°ˆæ¥­é¡§å•æœå‹™", "åœ˜éšŠå­¸ç¿’ç®¡ç†", "è©³ç´°å­¸ç¿’å ±å‘Š", "å½ˆæ€§èª²ç¨‹å®‰æ’", "ä¼æ¥­å°ˆå±¬å¹³å°", "å¤šèªè¨€æ”¯æ´", "24å°æ™‚æŠ€è¡“æ”¯æ´"],
                    "status": "PUBLISHED",
                    "category": "corporate"
                }
            ];
            
            localStorage.setItem('memberCardPlans', JSON.stringify(staticData));
            console.log('ğŸ”§ localStorage å·²åˆå§‹åŒ–ï¼Œæ–¹æ¡ˆæ•¸é‡:', staticData.length);
            refreshPlans();
        }

        function showLocalStorage() {
            const data = localStorage.getItem('memberCardPlans');
            if (data) {
                const plans = JSON.parse(data);
                console.log('ğŸ“¦ localStorage å…§å®¹:', plans);
            } else {
                console.log('âš ï¸ localStorage ç‚ºç©º');
            }
        }

        function togglePlanStatus(planId) {
            const data = localStorage.getItem('memberCardPlans');
            if (!data) {
                console.log('âŒ localStorage ç‚ºç©ºï¼Œè«‹å…ˆåˆå§‹åŒ–');
                return;
            }

            const plans = JSON.parse(data);
            const planIndex = plans.findIndex(p => p.id === planId);
            
            if (planIndex === -1) {
                console.log('âŒ æ‰¾ä¸åˆ°æ–¹æ¡ˆ ID:', planId);
                return;
            }

            const plan = plans[planIndex];
            const oldStatus = plan.status;
            plan.status = plan.status === 'PUBLISHED' ? 'DRAFT' : 'PUBLISHED';
            
            localStorage.setItem('memberCardPlans', JSON.stringify(plans));
            console.log(`ğŸ”„ æ–¹æ¡ˆ ${plan.name} ç‹€æ…‹å·²å¾ ${oldStatus} æ”¹ç‚º ${plan.status}`);
            
            // è§¸ç™¼æ›´æ–°äº‹ä»¶
            window.dispatchEvent(new CustomEvent('membershipPlansUpdated'));
            console.log('ğŸ”” å·²è§¸ç™¼ membershipPlansUpdated äº‹ä»¶');
            
            refreshPlans();
        }

        function refreshPlans() {
            const data = localStorage.getItem('memberCardPlans');
            const plansElement = document.getElementById('plans');
            
            if (!data) {
                plansElement.innerHTML = '<p>âš ï¸ localStorage ç‚ºç©º</p>';
                return;
            }

            const plans = JSON.parse(data);
            let html = '';
            
            plans.forEach(plan => {
                const statusClass = plan.status === 'PUBLISHED' ? 'published' : 'draft';
                html += `
                    <div class="plan ${statusClass}">
                        <strong>${plan.name}</strong> 
                        <span style="float: right;">
                            ç‹€æ…‹: ${plan.status} 
                            (${plan.status === 'PUBLISHED' ? 'å·²ç™¼å¸ƒ' : 'è‰ç¨¿'})
                        </span>
                        <br>
                        <small>ID: ${plan.id}, é¡å‹: ${plan.plan_type}, åƒ¹æ ¼: NT$ ${plan.price}</small>
                    </div>
                `;
            });
            
            plansElement.innerHTML = html;
            console.log('ğŸ”„ æ–¹æ¡ˆé¡¯ç¤ºå·²æ›´æ–°');
        }

        // ç›£è½æ›´æ–°äº‹ä»¶
        window.addEventListener('membershipPlansUpdated', function() {
            console.log('ğŸ‘‚ æ”¶åˆ° membershipPlansUpdated äº‹ä»¶');
        });

        // åˆå§‹è¼‰å…¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é é¢è¼‰å…¥å®Œæˆ');
            refreshPlans();
        });
    </script>
</body>
</html>