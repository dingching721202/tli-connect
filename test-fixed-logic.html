<!DOCTYPE html>
<html>
<head>
    <title>ä¿®å¾©å¾Œçš„èª²ç¨‹é€£çµé‚è¼¯æ¸¬è©¦</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .summary { background: #e8f5e8; border: 2px solid #4caf50; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .test { border: 1px solid #ccc; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .error { background: #ffe8e8; border-color: #f44336; }
        .warning { background: #fff3cd; border-color: #ffc107; }
        .code { background: #f5f5f5; padding: 10px; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ä¿®å¾©å¾Œçš„èª²ç¨‹é€£çµé‚è¼¯æ¸¬è©¦</h1>
    
    <div class="summary">
        <h2>ğŸ¯ é—œéµå•é¡Œç™¼ç¾</h2>
        <p><strong>å•é¡Œæ ¹æºï¼š</strong>é è¨­èª²ç¨‹æ¨¡æ¿ç”Ÿæˆæ™‚ï¼Œæ‰€æœ‰ Session çš„ <code>virtualClassroomLink</code> éƒ½è¢«è¨­ç‚ºä½”ä½ç¬¦ <code>'https://meet.google.com/course-session'</code></p>
        
        <p><strong>ä¿®å¾©å…§å®¹ï¼š</strong></p>
        <ul>
            <li>å¢å¼·äº† <code>isInvalidLink</code> å‡½æ•¸ï¼ŒåŒæ™‚æª¢æŸ¥ç©ºå€¼å’Œä½”ä½ç¬¦</li>
            <li>ä¿®æ”¹å›é€€é‚è¼¯ï¼Œç•¶å€‹åˆ¥é€£çµæ˜¯ä½”ä½ç¬¦æ™‚ä¹Ÿä½¿ç”¨çµ±ä¸€è¨­å®š</li>
            <li>ç¢ºä¿çµ±ä¸€è¨­å®šæœ¬èº«ä¹Ÿä¸æ˜¯ä½”ä½ç¬¦</li>
        </ul>
    </div>
    
    <div id="results"></div>
    
    <script>
        // æ¨¡æ“¬çœŸå¯¦çš„èª²ç¨‹æ¨¡æ¿æ•¸æ“šï¼ˆåŒ…å«ä½”ä½ç¬¦ï¼‰
        const mockTemplate = {
            id: 'template_pronunciation',
            title: 'Pronunciation',
            globalSettings: {
                defaultVirtualClassroomLink: 'https://meet.google.com/real-global-classroom',
                defaultMaterialLink: 'https://drive.google.com/real-global-materials'
            },
            sessions: [
                {
                    sessionNumber: 1,
                    title: 'Lesson 1',
                    virtualClassroomLink: 'https://meet.google.com/course-session', // ä½”ä½ç¬¦ï¼
                    materialLink: '' // ç©ºå€¼
                },
                {
                    sessionNumber: 2,
                    title: 'Lesson 2',
                    virtualClassroomLink: 'https://meet.google.com/lesson-2-special', // çœŸå¯¦é€£çµ
                    materialLink: 'https://drive.google.com/lesson-2-materials' // çœŸå¯¦é€£çµ
                },
                {
                    sessionNumber: 3,
                    title: 'Lesson 3',
                    virtualClassroomLink: 'https://meet.google.com/course-session', // ä½”ä½ç¬¦ï¼
                    materialLink: 'https://drive.google.com/lesson-3-materials' // çœŸå¯¦é€£çµ
                }
            ]
        };

        // ä¿®å¾©å¾Œçš„é‚è¼¯
        function getCourseLinksFromTemplate(courseName, lessonNumber) {
            console.log(`ğŸ” æŸ¥æ‰¾èª²ç¨‹é€£çµ: ${courseName} - Lesson ${lessonNumber}`);
            
            const courseTemplate = mockTemplate; // æ¨¡æ“¬æ‰¾åˆ°æ¨¡æ¿
            const session = courseTemplate.sessions.find(s => s.sessionNumber === lessonNumber);
            
            if (!session) {
                return { classroom: null, materials: null };
            }
            
            let classroom = session.virtualClassroomLink;
            let materials = session.materialLink;
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºç„¡æ•ˆé€£çµï¼ˆç©ºå€¼æˆ–ä½”ä½ç¬¦ï¼‰
            const isInvalidLink = (link) => {
                if (!link || link.trim() === '') return true;
                
                const placeholderLinks = [
                    'https://meet.google.com/course-session',
                    'https://example.com/classroom',
                    'https://placeholder.com',
                    'https://your-classroom-link.com',
                    'https://your-material-link.com'
                ];
                
                return placeholderLinks.includes(link.trim());
            };
            
            // å¦‚æœå€‹åˆ¥æ•™å®¤é€£çµç„¡æ•ˆï¼Œä½¿ç”¨çµ±ä¸€è¨­å®š
            if (isInvalidLink(classroom)) {
                classroom = courseTemplate.globalSettings?.defaultVirtualClassroomLink || null;
                if (classroom && !isInvalidLink(classroom)) {
                    console.log(`ğŸ“ ä½¿ç”¨çµ±ä¸€æ•™å®¤è¨­å®š: ${classroom}`);
                } else {
                    classroom = null;
                    console.log(`âš ï¸ æ•™å®¤é€£çµç„¡æ•ˆï¼Œçµ±ä¸€è¨­å®šä¹Ÿç„¡æ•ˆ`);
                }
            } else {
                console.log(`ğŸ“ ä½¿ç”¨å€‹åˆ¥æ•™å®¤è¨­å®š: ${classroom}`);
            }
            
            // å¦‚æœå€‹åˆ¥æ•™æé€£çµç„¡æ•ˆï¼Œä½¿ç”¨çµ±ä¸€è¨­å®š
            if (isInvalidLink(materials)) {
                materials = courseTemplate.globalSettings?.defaultMaterialLink || null;
                if (materials && !isInvalidLink(materials)) {
                    console.log(`ğŸ“„ ä½¿ç”¨çµ±ä¸€æ•™æè¨­å®š: ${materials}`);
                } else {
                    materials = null;
                    console.log(`âš ï¸ æ•™æé€£çµç„¡æ•ˆï¼Œçµ±ä¸€è¨­å®šä¹Ÿç„¡æ•ˆ`);
                }
            } else {
                console.log(`ğŸ“„ ä½¿ç”¨å€‹åˆ¥æ•™æè¨­å®š: ${materials}`);
            }
            
            return {
                classroom: classroom || null,
                materials: materials || null
            };
        }

        function isValidLink(link) {
            if (!link || link.trim() === '') return false;
            
            const placeholderLinks = [
                'https://meet.google.com/course-session',
                'https://example.com/classroom',
                'https://placeholder.com',
                'https://your-classroom-link.com',
                'https://your-material-link.com'
            ];
            
            if (placeholderLinks.includes(link.trim())) {
                return false;
            }
            
            try {
                if (link.startsWith('http://') || link.startsWith('https://')) {
                    new URL(link);
                    return true;
                }
                return false;
            } catch {
                return false;
            }
        }

        function getCourseLinksForLesson(courseName, lessonNumber) {
            const links = getCourseLinksFromTemplate(courseName, lessonNumber);
            
            return {
                classroom: isValidLink(links.classroom) ? links.classroom : null,
                materials: isValidLink(links.materials) ? links.materials : null,
                hasValidClassroom: isValidLink(links.classroom),
                hasValidMaterials: isValidLink(links.materials)
            };
        }

        // æ¸¬è©¦æ¡ˆä¾‹
        const testCases = [
            {
                description: 'Lesson 1 - å€‹åˆ¥é€£çµæ˜¯ä½”ä½ç¬¦ï¼Œæ‡‰ä½¿ç”¨çµ±ä¸€è¨­å®š',
                courseName: 'Pronunciation',
                lessonNumber: 1,
                sessionData: 'virtualClassroomLink: ä½”ä½ç¬¦, materialLink: ç©ºå€¼',
                expected: {
                    hasValidClassroom: true,
                    hasValidMaterials: true,
                    classroom: 'https://meet.google.com/real-global-classroom',
                    materials: 'https://drive.google.com/real-global-materials'
                }
            },
            {
                description: 'Lesson 2 - å€‹åˆ¥é€£çµéƒ½æ˜¯çœŸå¯¦çš„ï¼Œæ‡‰ä½¿ç”¨å€‹åˆ¥é€£çµ',
                courseName: 'Pronunciation',
                lessonNumber: 2,
                sessionData: 'virtualClassroomLink: çœŸå¯¦é€£çµ, materialLink: çœŸå¯¦é€£çµ',
                expected: {
                    hasValidClassroom: true,
                    hasValidMaterials: true,
                    classroom: 'https://meet.google.com/lesson-2-special',
                    materials: 'https://drive.google.com/lesson-2-materials'
                }
            },
            {
                description: 'Lesson 3 - æ··åˆæƒ…æ³ï¼ˆæ•™å®¤æ˜¯ä½”ä½ç¬¦ï¼Œæ•™ææ˜¯çœŸå¯¦çš„ï¼‰',
                courseName: 'Pronunciation',
                lessonNumber: 3,
                sessionData: 'virtualClassroomLink: ä½”ä½ç¬¦, materialLink: çœŸå¯¦é€£çµ',
                expected: {
                    hasValidClassroom: true,
                    hasValidMaterials: true,
                    classroom: 'https://meet.google.com/real-global-classroom',
                    materials: 'https://drive.google.com/lesson-3-materials'
                }
            }
        ];

        const results = document.getElementById('results');
        let allPassed = true;

        testCases.forEach((testCase, index) => {
            console.log(`\\n=== æ¸¬è©¦æ¡ˆä¾‹ ${index + 1}: ${testCase.description} ===`);
            
            const result = getCourseLinksForLesson(testCase.courseName, testCase.lessonNumber);
            
            const classroomMatch = result.classroom === testCase.expected.classroom;
            const materialsMatch = result.materials === testCase.expected.materials;
            const hasClassroomMatch = result.hasValidClassroom === testCase.expected.hasValidClassroom;
            const hasMaterialsMatch = result.hasValidMaterials === testCase.expected.hasValidMaterials;
            
            const passed = classroomMatch && materialsMatch && hasClassroomMatch && hasMaterialsMatch;
            allPassed = allPassed && passed;
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test ${passed ? 'success' : 'error'}`;
            
            resultDiv.innerHTML = `
                <h3>${testCase.description}</h3>
                <p><strong>Session æ•¸æ“š:</strong> ${testCase.sessionData}</p>
                
                <div class="code">
<strong>æ•™å®¤é€£çµ:</strong>
é æœŸ: ${testCase.expected.classroom}
å¯¦éš›: ${result.classroom || 'null'}
æœ‰æ•ˆ: ${result.hasValidClassroom} (é æœŸ: ${testCase.expected.hasValidClassroom})
åŒ¹é…: ${classroomMatch ? 'âœ…' : 'âŒ'}

<strong>æ•™æé€£çµ:</strong>
é æœŸ: ${testCase.expected.materials}
å¯¦éš›: ${result.materials || 'null'}
æœ‰æ•ˆ: ${result.hasValidMaterials} (é æœŸ: ${testCase.expected.hasValidMaterials})
åŒ¹é…: ${materialsMatch ? 'âœ…' : 'âŒ'}
                </div>
                
                <p style="color: ${passed ? 'green' : 'red'}; font-weight: bold;">
                    ${passed ? 'âœ… é€šé' : 'âŒ å¤±æ•—'}
                </p>
            `;
            
            results.appendChild(resultDiv);
        });

        // ç¸½çµ
        const summary = document.createElement('div');
        summary.className = `test ${allPassed ? 'success' : 'error'}`;
        summary.innerHTML = `
            <h2>ğŸ‰ ä¿®å¾©çµæœ</h2>
            <p>ç¸½å…± ${testCases.length} å€‹æ¸¬è©¦æ¡ˆä¾‹</p>
            <p style="color: ${allPassed ? 'green' : 'red'}; font-weight: bold;">
                ${allPassed ? 'ğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼' : 'âŒ æœ‰æ¸¬è©¦å¤±æ•—ã€‚'}
            </p>
            
            <h3>âœ… ä¿®å¾©é©—è­‰ï¼š</h3>
            <div class="code">
1. âœ… ä½”ä½ç¬¦é€£çµè¢«æ­£ç¢ºè­˜åˆ¥ç‚ºç„¡æ•ˆ
2. âœ… å€‹åˆ¥é€£çµæ˜¯ä½”ä½ç¬¦æ™‚è‡ªå‹•ä½¿ç”¨çµ±ä¸€è¨­å®š
3. âœ… å€‹åˆ¥é€£çµæ˜¯çœŸå¯¦é€£çµæ™‚ä½¿ç”¨å€‹åˆ¥é€£çµ
4. âœ… æ··åˆæƒ…æ³è™•ç†æ­£ç¢º
5. âœ… çµ±ä¸€è¨­å®šæœ¬èº«ä¹Ÿæœƒè¢«é©—è­‰
            </div>
            
            <p style="background: #e3f2fd; padding: 15px; border-radius: 5px; border-left: 4px solid #2196f3;">
                <strong>ğŸ“¢ ç¾åœ¨æ•™å¸«å¯ä»¥ï¼š</strong><br>
                â€¢ åœ¨èª²ç¨‹æ¨¡çµ„ä¸­è¨­å®šçµ±ä¸€çš„æ•™å®¤å’Œæ•™æé€£çµ<br>
                â€¢ ç‚ºç‰¹å®š Lesson è¨­å®šå°ˆå±¬é€£çµ<br>
                â€¢ åœ¨å„€è¡¨æ¿å’Œæˆ‘çš„é ç´„ä¸­ç²å–æ­£ç¢ºçš„é€£çµ<br>
                â€¢ ç³»çµ±æœƒè‡ªå‹•è™•ç†ä½”ä½ç¬¦å’Œç©ºå€¼çš„å›é€€é‚è¼¯
            </p>
        `;
        
        results.appendChild(summary);
    </script>
</body>
</html>